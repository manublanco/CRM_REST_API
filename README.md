# CRM REST API

The objective is to create a REST API to manage customer data for a small shop. It
will work as the backend side for a CRM interface.

## SETUP

This application is made with Spring-boot so it is very easy to install and run. Also, I used an H2 Database and there is no need to configure anything else. The only thing you need to do is run this command inside the project folder (I assume you already have a Maven installation in your computer) :
> `mvn clean spring-boot:run`

## AUTHENTICATION AND AUTHORIZATION

All the endpoints needs basic authentication with username and password to run. There are two different roles in this app, user role and admin role. An user can create customers, update customers, get info of customers and delete customers. An admin can do all the operations with customers and also create users, delete users, update users, get users info and also can grant admin role to another user. 

At init the app creates 3 different users (1 ADMIN and 2 USERS). 

|  USERNAME|PASSWORD  |ROLE|  
|--|--|--|
|  Stark| 1234  |ADMIN
|  Captain   |  1234     |USER
|Spidey    | 1234|USER


## ENDPOINTS

To do all the tests I use POSTMAN. Now I am going to explain how to test every endpoint and how to use postman to do it in cases that I think is needed.

All endpoints needs to be authenticated. In Postman you can do this in the section Authorization, then select Basic Authorization and use the credentials of one of the users already created.


### User endpoints

This endpoints are only accesible by an ADMIN. 

#### List all users
#### GET http://localhost:8080/user

If you send a GET request in POSTMAN to this endpoint, you will receive a list of all users in JSON format. 

```javascript
[
    {
        "id": 1,
        "name": "Tony",
        "surname": "Stark",
        "role": "ADMIN",
        "username": "Stark",
        "password": "1234"
    },
    {
        "id": 2,
        "name": "Steve",
        "surname": "Rogers",
        "role": "USER",
        "username": "Captain",
        "password": "1234"
    },
    {
        "id": 3,
        "name": "Peter",
        "surname": "Parker",
        "role": "USER",
        "username": "Spidey",
        "password": "1234"
    }
]
```


#### Get user info by id
#### GET http://localhost:8080/user/{id}

If you send a GET request with a specific id, for instance: http://localhost:8080/user/1

You will receive a JSON with the information of that particular user.
```javascript
{
    "id": 1,
    "name": "Tony",
    "surname": "Stark",
    "role": "ADMIN",
    "username": "Stark",
    "password": "1234"
}
```

If the user with that id doesn' exist you will receive a 404 Error with the message "User not found for ID: 1"

#### Create User
#### POST http://localhost:8080/user/

To create an user you have to send a POST request with a JSON in the body. So, in POSTMAN you have to select POST request and then in the body part, select raw, application/json and insert a JSON like this: 
```javascript
{
    "name": "Hank",
    "surname": "Pym",
    "username": "Pym",
    "password": "1234"
}
```
The id field is autogenerated.

The username has to be unique, so if the username is already taken the endpoint will show a 400 Bad Request with the message "Username already taken"

All the fields are required, so if you forgot to put a field the endpoint will show a 400 Bad Request with the message "Please provide all mandatory inputs"

By default, all users are created with the USER role.

#### Update User
#### PUT http://localhost:8080/user/{id}

Select a PUT request in Postman.

To update the user with the id {id} you have to send a JSON just like when you created the user but only with the fields that you want to change. Example with id=4 

http://localhost:8080/user/4

```javascript
{
    "username": "Ant-man"
}
```
If the user with that id doesn't exist you will receive a 404 Error with the message "User not found for ID: 1"


#### Delete User
#### DELETE http://localhost:8080/user/{id}

Select DELETE request in Postman and you only have to specified the id of the user you want to delete. 
If the user with that id doesn' exist you will receive a 404 Error with the message "User not found for ID: 1"

http://localhost:8080/user/4

#### Change role
#### PUT http://localhost:8080/user/{id}/isAdmin/{isAdmin}

PUT request in Postman.

You only need to specify the id of the user and change {isAdmin} to true if you want to grant ADMIN role or to false if you want to grant USER role. 

Examples:

* http://localhost:8080/user/1/isAdmin/false   -> The user 1 will have USER role.
* http://localhost:8080/user/1/isAdmin/true    -> The user 1 will haver ADMIN role.  

## Customer endpoints

This endpoints are accesible by ADMINS and USERS.

#### List all customers
#### GET http://localhost:8080/customer

If you send a GET request in POSTMAN to this endpoint, you will receive a list of all customers in JSON format. 

```javascript
[
    {
        "id": 1,
        "name": "Mary Jane",
        "surname": "Parker",
        "photoField": "https://www.googleapis.com/download/storage/v1/b/crm-theam-rest-api-images/o/maryjane.jpeg?generation=1534242512296495&alt=media",
        "createdBy": {
            "id": 3,
            "name": "Peter",
            "surname": "Parker",
            "role": "USER",
            "username": "Spidey",
            "password": "1234"
        },
        "creationDate": "2018-08-14",
        "updatedBy": null,
        "lastUpdate": null
    },
    {
        "id": 2,
        "name": "May",
        "surname": "Parker",
        "photoField": "https://www.googleapis.com/download/storage/v1/b/crm-theam-rest-api-images/o/MayParker.jpg?generation=1534242512421260&alt=media",
        "createdBy": {
            "id": 3,
            "name": "Peter",
            "surname": "Parker",
            "role": "USER",
            "username": "Spidey",
            "password": "1234"
        },
        "creationDate": "2018-08-14",
        "updatedBy": null,
        "lastUpdate": null
    }
]
```


#### Get customer info by id
#### GET http://localhost:8080/customer/{id}

If you send a GET request with a specific id, for instance: http://localhost:8080/customer/1

You will receive a JSON with the information of that particular customer.
```javascript
{
    "id": 1,
    "name": "Mary Jane",
    "surname": "Parker",
    "photoField": "https://www.googleapis.com/download/storage/v1/b/crm-theam-rest-api-images/o/maryjane.jpeg?generation=1534242512296495&alt=media",
    "createdBy": {
        "id": 3,
        "name": "Peter",
        "surname": "Parker",
        "role": "USER",
        "username": "Spidey",
        "password": "1234"
    },
    "creationDate": "2018-08-14",
    "updatedBy": null,
    "lastUpdate": null
}
```

If the user with that id doesn't exist you will receive a 404 Error with the message "Customer not found for ID: 1"


#### Create Customer
#### POST http://localhost:8080/customer/

POST request in Postman.

Then you have to select form-data and add two keys, "file"(type file) and "customer" (type text).
In file, now you have the option to upload an image. This image will be upload to Google Cloud Storage and save the url in the PhotoField of the customer. 

Into the customer key you have to send a JSON like this example:
```javascript
{
    "name": "Natasha",
    "surname": "Romanova"
}
```
The id field is autogenerated.

The only fields mandatory are name and surname. 

The file is optional.

The user who created the customer will be stored in the field "CreatedBy".


#### Update Customer
#### PUT http://localhost:8080/customer/{id}

PUT request in Postman.

Then you have to select form-data and add two keys, "file"(type file) and "customer" (type text).
In file, now you have the option to upload an image. This image will be upload to Google Cloud Storage and save the url in the PhotoField of the customer. 

Into the customer key you have to send a JSON like this example:
```javascript
{
    "surname": "Stark"
}
```

Only send the changes, it is not necessary to send all the data. 

The user who updated the customer will be stored in the field "CreatedBy".

#### Delete Customer
#### DELETE http://localhost:8080/customer/{id}

Select DELETE request in Postman and you only have to specified the id of the customer you want to delete. 
If the customer with that id doesn' exist you will receive a 404 Error with the message "Customer not found for ID: 1"


